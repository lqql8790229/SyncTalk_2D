# SyncTalk 数字人直播软件 — 产品方案 & 改造计划

## 一、产品概述

### 产品名称
**SyncTalk** — AI 数字人直播助手

### 一句话定位
录制一段视频训练你的专属数字人，一键开启虚拟摄像头直播，对着麦克风说话或输入文字，数字人实时同步口型。

### 用户价值
| 传统直播 | SyncTalk |
|---------|----------|
| 必须真人出镜 | 数字人替你出镜 |
| 受限于形象/状态 | 形象恒定，随时可播 |
| 无法 24h 直播 | 文字驱动，无人值守 |
| 需要专业设备 | 一张显卡 + 麦克风 |

---

## 二、核心功能 & 用户流程

### 2.1 完整用户旅程

```
                           SyncTalk 用户旅程
 ═══════════════════════════════════════════════════════════

 ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
 │  下载安装  │ →  │  注册登录  │ →  │  训练数字人 │ →  │  开始直播  │
 │  (1分钟)  │    │  (30秒)   │    │  (等待5小时)│    │  (1键启动) │
 └──────────┘    └──────────┘    └──────────┘    └──────────┘
```

### 2.2 功能一：训练数字人

**用户操作**（3 步完成）：

```
 第1步                    第2步                    第3步
 ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
 │  📂 选择视频文件   │     │  ▶️ 点击"开始训练" │     │  ✅ 训练完成      │
 │                 │     │                 │     │                 │
 │  要求:           │     │  自动完成:       │     │  结果:           │
 │  · 5分钟正脸视频  │     │  · 提取帧/音频   │     │  · 你的数字人就绪  │
 │  · 光线充足      │     │  · 检测人脸关键点  │     │  · 可以开始直播    │
 │  · 背景稳定      │  →  │  · 训练SyncNet   │  →  │                 │
 │                 │     │  · 训练UNet      │     │  耗时: 约5小时    │
 │  格式: MP4       │     │  · 显示进度条     │     │  (GTX 1060+)    │
 └─────────────────┘     └─────────────────┘     └─────────────────┘
```

**GUI 界面**：
```
 ┌─────────────────────────────────────────────────────┐
 │  训练数字人                                     [x]  │
 ├─────────────────────────────────────────────────────┤
 │                                                     │
 │  数字人名称: [我的数字人____________]                  │
 │                                                     │
 │  训练视频:  [/Users/xxx/video.mp4] [选择文件...]       │
 │                                                     │
 │  分辨率:    ● 标清 (160px, 更快)                      │
 │            ○ 高清 (328px, 推荐)                      │
 │                                                     │
 │  ┌─────────────────────────────────────────────┐    │
 │  │  视频预览                                    │    │
 │  │  ┌─────────────┐                            │    │
 │  │  │             │  ✅ 检测到人脸              │    │
 │  │  │  [预览画面]   │  ✅ 分辨率: 1920x1080     │    │
 │  │  │             │  ✅ 时长: 5分12秒           │    │
 │  │  └─────────────┘  ✅ 帧率: 30fps            │    │
 │  └─────────────────────────────────────────────┘    │
 │                                                     │
 │  GPU: NVIDIA RTX 3060 (12GB) ✅                     │
 │  预计训练时间: 约 3 小时                              │
 │                                                     │
 │            [████████████████░░░░░] 78%               │
 │            阶段: UNet 训练中 (Epoch 78/100)           │
 │            已用时: 2小时21分 | 剩余: 约40分钟          │
 │                                                     │
 │                         [ 🎯 开始训练 ]                │
 └─────────────────────────────────────────────────────┘
```

### 2.3 功能二：数字人直播

**用户操作**（1 键启动）：

```
 选择数字人 → 选择音频源 → 点击"开始直播" → 虚拟摄像头就绪
                                              ↓
                              在 OBS/Zoom/抖音 中选择 "SyncTalk Camera"
```

**GUI 界面**：
```
 ┌─────────────────────────────────────────────────────────────────┐
 │  SyncTalk 数字人直播                                       [_][x]│
 ├─────────────────────────────────────────────────────────────────┤
 │                                                                 │
 │  ┌─────────────────────────────────┐  ┌──────────────────────┐  │
 │  │                                 │  │  角色                 │  │
 │  │                                 │  │  ┌──┐ ┌──┐ ┌──┐     │  │
 │  │       [实时预览画面]              │  │  │😀│ │🧑│ │👩│ +   │  │
 │  │       数字人口型与语音同步         │  │  └──┘ └──┘ └──┘     │  │
 │  │                                 │  │  我的数字人  角色2      │  │
 │  │                                 │  ├──────────────────────┤  │
 │  │                                 │  │  音频来源             │  │
 │  │                                 │  │  ● 🎤 麦克风          │  │
 │  │          25 FPS | 3.2ms         │  │  ○ 📝 文字输入(TTS)   │  │
 │  └─────────────────────────────────┘  │  ○ 📁 音频文件        │  │
 │                                       ├──────────────────────┤  │
 │                                       │  虚拟摄像头           │  │
 │                                       │  📷 SyncTalk Camera  │  │
 │                                       │  状态: ● 运行中       │  │
 │                                       ├──────────────────────┤  │
 │                                       │  性能                 │  │
 │                                       │  FPS:    25.0        │  │
 │                                       │  延迟:   3.2ms       │  │
 │                                       │  GPU:    RTX 3060    │  │
 │                                       │  显存:   412MB/12GB  │  │
 │                                       ├──────────────────────┤  │
 │  ┌───────────────────────────────────┐│                      │  │
 │  │ 📝 文字输入 (TTS 模式时显示)        ││  [🟢 开始直播]        │  │
 │  │ [输入文字，数字人自动朗读...]        ││  [⏹️ 停止]           │  │
 │  └───────────────────────────────────┘│                      │  │
 │                                       └──────────────────────┘  │
 └─────────────────────────────────────────────────────────────────┘
```

**文字驱动模式**（TTS）：
```
 用户输入文字 → edge-tts/CosyVoice → 语音 → AudioEncoder → UNet → 虚拟摄像头
                  200ms 首字延迟         之后流畅播放 25fps
```

---

## 三、技术改造计划

### 3.1 现有代码资产盘点

```
 已完成                                              需要新建
 ──────────────────────────                         ──────────────────
 synctalk/models/      → UNet, SyncNet, AudioEnc    synctalk/tts/
 synctalk/realtime/    → 管线, 音频, 虚拟摄像头       synctalk/gui/
 synctalk/training/    → 训练器, 损失, 指标           synctalk/server/
 synctalk/data/        → 数据集, 预处理, 增强         synctalk/auth/
 synctalk/inference/   → 离线推理引擎                 synctalk/cloud/
 synctalk/configs/     → 配置系统                    synctalk/packaging/
 synctalk/api/         → REST API + 中间件
 synctalk/sdk.py       → Python SDK
 synctalk/cli.py       → 命令行工具
 tests/                → 91 个单元测试

 代码量: 3,723 行 (37 文件)                          预计新增: ~4,000 行
```

### 3.2 技术选型总结

| 组件 | 选型 | 理由 |
|------|------|------|
| 桌面框架 | **PyQt6** | Python 原生，嵌入 GPU 预览，跨平台 |
| TTS | **edge-tts** (MVP) → **CosyVoice** (V2) | 零成本 → 本地高质量 |
| 云端 API | **FastAPI + PostgreSQL** | 已有 FastAPI 基础 |
| ORM | **SQLAlchemy 2.0 + Alembic** | 标准迁移管理 |
| 认证 | **JWT (PyJWT)** | 无状态，客户端友好 |
| 模型存储 | **阿里云 OSS** | CDN + 签名 URL |
| 打包 | **PyInstaller** | Python → exe |
| 推理优化 | **FP16 + 异步管线** | 一行代码翻倍速度 |
| 虚拟摄像头 | **pyvirtualcam** | 已集成 |

### 3.3 改造任务清单

#### 🔴 P0 — 核心功能（必须做，5-6 周）

| # | 任务 | 工时 | 依赖 | 交付物 |
|---|------|------|------|--------|
| 1 | FP16 + 异步管线优化 | 2天 | 无 | 推理速度翻倍 |
| 2 | TTS 集成 (edge-tts) | 3天 | 无 | 文字→数字人全链路 |
| 3 | 训练向导 GUI | 1周 | 无 | 视频选择→训练→完成 |
| 4 | 直播控制台 GUI | 1.5周 | #1,#2 | 角色选择→直播→虚拟摄像头 |
| 5 | 云端 API (认证+角色) | 1周 | 无 | 注册/登录/角色CRUD |
| 6 | 客户端认证集成 | 3天 | #5 | 登录界面+授权缓存 |
| 7 | PyInstaller 打包 | 3天 | #3,#4 | Windows exe 安装包 |

#### 🟡 P1 — 体验增强（应该做，3-4 周）

| # | 任务 | 工时 | 依赖 | 交付物 |
|---|------|------|------|--------|
| 8 | 模型 CDN 分发 + 断点续传 | 4天 | #5 | 角色模型云端同步 |
| 9 | TensorRT 加速 | 3天 | #1 | 极致推理速度 |
| 10 | 高级 TTS (CosyVoice) | 1周 | #2 | 本地高质量 + 声音克隆 |
| 11 | 授权系统 | 3天 | #5 | Free/Pro/Business 分级 |
| 12 | 使用统计 + 心跳 | 2天 | #5 | 用量分析 |
| 13 | 系统托盘 + 开机启动 | 2天 | #4 | 后台运行 |
| 14 | 自动更新 | 3天 | #7 | 客户端热更新 |

#### 🟢 P2 — 商业扩展（可以做，4-6 周）

| # | 任务 | 工时 | 依赖 | 交付物 |
|---|------|------|------|--------|
| 15 | 模型市场 | 1.5周 | #8 | 角色交易平台 |
| 16 | LLM 对接 (GPT/通义) | 1周 | #2,#10 | AI 自动回复弹幕 |
| 17 | macOS 适配 | 1周 | #7 | .app 打包 |
| 18 | 多语言 UI | 3天 | #4 | 中/英/日 |
| 19 | 直播画面模板 | 1周 | #4 | 背景/边框/弹幕叠加 |
| 20 | 管理后台 (Web) | 2周 | #5,#11 | 用户/订单/数据仪表板 |

### 3.4 实施路线图

```
                Week 1      Week 2      Week 3      Week 4      Week 5      Week 6
 ─────────────────────────────────────────────────────────────────────────────────
 P0 核心功能:
   #1 推理优化   ██
   #2 TTS集成    ███
   #5 云端API    ████████
   #3 训练GUI                ████████████
   #6 认证集成               ████
   #4 直播GUI                        ████████████████
   #7 打包分发                                       ████████

 P1 体验增强:                                                    并行推进 →→→
   #8 CDN分发                                                    ████████
   #9 TensorRT                                                   ██████
   #10 高级TTS                                                         ████████
 ─────────────────────────────────────────────────────────────────────────────────
                     ↑ MVP 内测                              ↑ V1.0 发布
```

**MVP（第4周末）**：用户可以注册→训练数字人→麦克风直播
**V1.0（第6周末）**：完整产品 + TTS + 打包安装

---

## 四、数据架构

### 4.1 云端数据模型（PostgreSQL）

```sql
-- 用户
CREATE TABLE users (
    id            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email         VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    display_name  VARCHAR(100),
    plan          VARCHAR(20) DEFAULT 'free',  -- free/pro/business
    created_at    TIMESTAMPTZ DEFAULT NOW(),
    last_login    TIMESTAMPTZ
);

-- 数字人角色
CREATE TABLE characters (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id         UUID REFERENCES users(id) ON DELETE CASCADE,
    name            VARCHAR(100) NOT NULL,
    resolution      INT DEFAULT 328,
    asr_mode        VARCHAR(20) DEFAULT 'ave',
    status          VARCHAR(20) DEFAULT 'training',  -- training/ready/error
    frame_count     INT,
    checkpoint_hash VARCHAR(64),       -- SHA256 校验
    model_url       VARCHAR(500),      -- CDN 下载链接
    thumbnail_url   VARCHAR(500),      -- 缩略图
    file_size_mb    FLOAT,
    training_hours  FLOAT,
    created_at      TIMESTAMPTZ DEFAULT NOW()
);

-- 设备授权
CREATE TABLE licenses (
    id            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id       UUID REFERENCES users(id),
    license_key   VARCHAR(64) UNIQUE NOT NULL,
    plan          VARCHAR(20) NOT NULL,
    machine_id    VARCHAR(128),        -- 绑定设备指纹
    activated_at  TIMESTAMPTZ,
    expires_at    TIMESTAMPTZ,
    status        VARCHAR(20) DEFAULT 'active'
);

-- 使用记录
CREATE TABLE usage_logs (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id         UUID REFERENCES users(id),
    character_id    UUID REFERENCES characters(id),
    session_start   TIMESTAMPTZ NOT NULL,
    session_end     TIMESTAMPTZ,
    duration_min    FLOAT,
    mode            VARCHAR(20),       -- mic/tts/file
    fps_avg         FLOAT,
    gpu_model       VARCHAR(100)
);
```

### 4.2 本地数据结构

```
~/.synctalk/                          # 用户数据目录
├── config.yaml                       # 用户偏好设置
│   ├── resolution: 328
│   ├── fps: 25
│   ├── camera_width: 1280
│   ├── camera_height: 720
│   ├── default_character: "xxx"
│   ├── tts_engine: "edge-tts"
│   └── tts_voice: "zh-CN-XiaoxiaoNeural"
│
├── auth.json                         # 认证缓存 (加密)
│   ├── token: "eyJ..."
│   ├── refresh_token: "xxx"
│   └── expires_at: "2025-..."
│
├── license.json                      # 授权缓存
│   ├── plan: "pro"
│   ├── machine_id: "xxx"
│   └── valid_until: "2025-..."
│
├── characters/                       # 角色数据
│   ├── {character_id}/
│   │   ├── meta.json                 # 元数据
│   │   ├── model.pth                 # UNet 权重 (~47MB)
│   │   ├── frames/                   # 预处理帧 (JPG)
│   │   │   ├── 0.jpg
│   │   │   ├── 1.jpg
│   │   │   └── ...
│   │   └── landmarks/                # 关键点
│   │       ├── 0.lms
│   │       └── ...
│   └── ...
│
└── models/                           # 共享基础模型
    └── audio_visual_encoder.pth      # AudioEncoder (11MB)
```

---

## 五、界面设计规范

### 5.1 设计原则

1. **三步完成**：任何核心操作不超过 3 步
2. **零术语**：界面上不出现 "UNet"、"SyncNet"、"mel" 等技术词汇
3. **状态可见**：训练进度、直播状态、性能指标实时可见
4. **错误可恢复**：所有错误给出明确指引

### 5.2 界面结构

```
 ┌──────────────────────────────────────────────┐
 │           SyncTalk (系统托盘常驻)              │
 │                                              │
 │  Tab 1: 直播控台        ← 主界面，启动后默认    │
 │  Tab 2: 我的数字人       ← 角色管理/训练        │
 │  Tab 3: 设置            ← 偏好/账号/关于        │
 └──────────────────────────────────────────────┘
```

### 5.3 关键交互流

**首次使用**：
```
 启动 → 注册/登录 → 「还没有数字人，立即创建一个？」 → 训练向导
```

**日常使用**：
```
 启动 → 自动登录 → 选角色 → 选音频源 → [开始直播] → 最小化到托盘
```

**直播中切换模式**：
```
 麦克风模式 ←→ 文字模式 (实时切换，不中断虚拟摄像头)
```

---

## 六、性能方案

### 6.1 推理优化（已验证可行）

| 优化 | 实施 | 效果 | 代码改动 |
|------|------|------|---------|
| FP16 半精度 | `model.half()` | 速度 ×2，显存 ÷2 | 1 行 |
| 异步管线 | 推理/渲染双线程 | 吞吐 ×2 | pipeline.py |
| 静音跳帧 | 检测音频能量 | 省 20-40% 算力 | pipeline.py |
| GPU 预加载 | 帧常驻显存 | 省 ~1ms/帧 | character.py |

### 6.2 用户感知的延迟

| 场景 | 体感延迟 | 用户感受 |
|------|---------|---------|
| 麦克风→数字人 | ~50ms | 嘴唇和说话完全同步，无感知 |
| 文字→TTS→数字人 | ~200ms 首字 | 打字后 0.2s 开口，之后连续 |
| AI 回复弹幕 | ~1-2s | LLM 响应时间为主 |

### 6.3 硬件要求

| 配置 | 328px 高清 | 160px 标清 |
|------|-----------|-----------|
| **最低**: GTX 1060 6GB | 50 fps ✅ | 100 fps ✅ |
| **推荐**: RTX 3060 12GB | 140 fps ✅ | 250 fps ✅ |
| **最佳**: RTX 4060+ | 170+ fps ✅ | 340+ fps ✅ |

---

## 七、商业模式

### 7.1 付费体系

```
 ┌──────────────────────────────────────────────────────┐
 │                                                      │
 │  🆓 Free              ⭐ Pro ¥99/月    💎 Business   │
 │                                        ¥499/月       │
 │  1 个数字人            5 个数字人        无限数字人     │
 │  160px 标清            328px 高清        高清+自定义    │
 │  2小时/天              无限时长          无限时长       │
 │  有水印               无水印            无水印         │
 │  麦克风模式            + 文字/TTS 模式   + AI 弹幕回复  │
 │  社区支持              邮件支持          专属支持       │
 │                                        + 模型市场      │
 │  [免费开始]            [升级 Pro]        [联系商务]     │
 └──────────────────────────────────────────────────────┘
```

### 7.2 限制实现方式

| 限制 | 实现 | 位置 |
|------|------|------|
| 角色数量 | 云端 API 检查 `characters` 表 count | server |
| 分辨率 | 客户端根据 plan 传入 config.resolution | client |
| 时长限制 | 客户端心跳上报，累计到 2h 弹窗 | client |
| 水印 | Free 版渲染时叠加半透明 logo | pipeline.py |
| TTS 模式 | Free 版禁用文字输入面板 | gui |

### 7.3 云端成本

| 用户规模 | 月成本 | 每用户成本 |
|---------|--------|-----------|
| 100 | ¥290 | ¥2.9 |
| 1,000 | ¥500 | ¥0.5 |
| 10,000 | ¥2,000 | ¥0.2 |

---

## 八、风险 & 应对

| 风险 | 概率 | 影响 | 应对 |
|------|------|------|------|
| 用户 GPU 不兼容 | 中 | 无法使用 | 提供 160px 低配模式 + GPU 检测前置 |
| 虚拟摄像头驱动问题 | 中 | 无法直播 | 内置 OBS 插件安装引导 |
| TTS 质量不达预期 | 低 | 体验差 | 预留 CosyVoice 升级路径 |
| 模型被反编译提取 | 中 | IP 泄露 | 模型加密 + 运行时解密 |
| 竞品跟进 | 高 | 市场竞争 | 快速迭代 + 模型市场生态 |
